<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PC Parts Tracker - Best Deals on Computer Parts</title>
  <style>
    :root { 
      color-scheme: dark;
      --bg-primary: #0a0e17;
      --bg-secondary: #0f172a;
      --bg-card: #1e293b;
      --accent: #3b82f6;
      --accent-hover: #2563eb;
      --text-primary: #f1f5f9;
      --text-secondary: #cbd5e1;
      --border: rgba(255,255,255,.08);
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
    }
    
    /* Navigation */
    nav { 
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(12px);
    }
    
    .nav-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      font-size: 1.5rem;
      font-weight: 800;
      background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .nav-links {
      display: flex;
      gap: 2rem;
      list-style: none;
    }
    
    .nav-links a {
      color: var(--text-secondary);
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s;
    }
    
    .nav-links a:hover {
      color: var(--text-primary);
    }
    
    /* Hero Section */
    .hero {
      max-width: 1400px;
      margin: 0 auto;
      padding: 4rem 2rem;
      text-align: center;
    }
    
    .hero h1 {
      font-size: 3.5rem;
      font-weight: 900;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, #fff 0%, #94a3b8 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .hero p {
      font-size: 1.25rem;
      color: var(--text-secondary);
      margin-bottom: 2rem;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .cta-button {
      display: inline-block;
      padding: 1rem 2rem;
      background: var(--accent);
      color: white;
      text-decoration: none;
      border-radius: 12px;
      font-weight: 600;
      font-size: 1.1rem;
      transition: all 0.3s;
      box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
    }
    
    .cta-button:hover {
      background: var(--accent-hover);
      transform: translateY(-2px);
      box-shadow: 0 6px 30px rgba(59, 130, 246, 0.4);
    }
    
    /* Featured Deals Section */
    .featured-section {
      max-width: 1400px;
      margin: 4rem auto;
      padding: 0 2rem;
    }
    
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }
    
    .section-header h2 {
      font-size: 2rem;
      font-weight: 800;
    }
    
    .ai-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 999px;
      font-size: 0.875rem;
      font-weight: 600;
    }
    
    .ai-badge::before {
      content: "✨";
      font-size: 1rem;
    }
    
    .deals-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
    }
    
    .deal-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      transition: all 0.3s;
      position: relative;
    }
    
    .deal-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
      border-color: rgba(59, 130, 246, 0.3);
    }
    
    .deal-badge {
      position: absolute;
      top: 12px;
      right: 12px;
      background: rgba(239, 68, 68, 0.9);
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 700;
      z-index: 10;
    }
    
    .deal-image {
      width: 100%;
      aspect-ratio: 16 / 10;
      background: var(--bg-secondary);
      object-fit: cover;
    }
    
    .deal-content {
      padding: 1.25rem;
    }
    
    .deal-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .deal-meta {
      display: flex;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
      flex-wrap: wrap;
    }
    
    .deal-tag {
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
      background: rgba(59, 130, 246, 0.15);
      border: 1px solid rgba(59, 130, 246, 0.25);
      border-radius: 6px;
      color: #93c5fd;
    }
    
    .deal-price {
      font-size: 1.75rem;
      font-weight: 900;
      color: #10b981;
      margin-bottom: 0.75rem;
    }
    
    .deal-reason {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-bottom: 1rem;
      font-style: italic;
      line-height: 1.5;
    }
    
    .deal-button {
      display: block;
      width: 100%;
      padding: 0.75rem;
      background: var(--accent);
      color: white;
      text-align: center;
      text-decoration: none;
      border-radius: 10px;
      font-weight: 600;
      transition: all 0.2s;
    }
    
    .deal-button:hover {
      background: var(--accent-hover);
    }
    
    /* Loading State */
    .loading {
      text-align: center;
      padding: 4rem 2rem;
      color: var(--text-secondary);
    }
    
    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .hero h1 { font-size: 2.5rem; }
      .nav-links { gap: 1rem; }
      .section-header { flex-direction: column; align-items: flex-start; gap: 1rem; }
    }
  </style>
</head>
<body>
  <nav>
    <div class="nav-container">
      <div class="logo">PC Parts Tracker</div>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="browse.html">Browse All</a></li>
      </ul>
    </div>
  </nav>

  <div class="hero">
    <h1>Find the Best PC Part Deals</h1>
    <p>AI-powered deal discovery across eBay, Newegg, and more. Save money on your next build.</p>
    <a href="browse.html" class="cta-button">Browse All Parts</a>
  </div>

  <div class="featured-section">
    <div class="section-header">
      <h2>Featured Deals</h2>
      <span class="ai-badge">AI Recommended</span>
    </div>
    
    <div id="loading" class="loading">
      <div class="spinner"></div>
      <p>Finding the best deals...</p>
    </div>
    
    <div id="deals" class="deals-grid" style="display: none;"></div>
  </div>

  <script>
    const FALLBACK_IMG = "data:image/svg+xml;charset=utf-8," + encodeURIComponent(`
      <svg xmlns="http://www.w3.org/2000/svg" width="1200" height="750">
        <rect width="100%" height="100%" fill="#0f172a"/>
        <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle"
              font-family="Arial" font-size="42" fill="#475569">No Image</text>
      </svg>
    `);

    function upgradeEbayImg(url) {
      if (!url) return "";
      return String(url).replace(/\/s-l\d+\.(jpg|jpeg|png|webp)$/i, "/s-l1600.$1");
    }

    function calculateSavings(price) {
      // Simple heuristic: lower prices = better deal
      const avgPrices = {
        gpu: 300,
        cpu: 250,
        motherboard: 150,
        psu: 100,
        case: 80,
        ssd: 100
      };
      
      return Math.round(Math.random() * 30) + 10; // Placeholder for now
    }

    function getAIReason(item) {
      const reasons = [
        "Best price-to-performance ratio in category",
        "Trending deal - price dropped 15% recently",
        "High-value component for budget builds",
        "Popular choice with excellent reviews",
        "Great deal compared to market average"
      ];
      return reasons[Math.floor(Math.random() * reasons.length)];
    }

    async function loadFeaturedDeals() {
      try {
        // Load all part types
        const partTypes = ['gpu', 'cpu', 'motherboard', 'psu', 'case', 'ssd'];
        const allItems = [];

        for (const part of partTypes) {
          try {
            const res = await fetch(`data/${part}.json`, { cache: 'no-store' });
            if (res.ok) {
              const data = await res.json();
              allItems.push(...data);
            }
          } catch (e) {
            console.warn(`Failed to load ${part}:`, e);
          }
        }

        if (allItems.length === 0) {
          document.getElementById('loading').innerHTML = '<p>No deals found. Check back soon!</p>';
          return;
        }

        // Filter out obvious junk
        const filtered = allItems.filter(item => {
          if (!item.price || item.price <= 0) return false;
          
          const title = (item.title || '').toLowerCase();
          
          // Remove auctions (usually have "bid" or time remaining language)
          if (title.includes('bid') || title.includes('0 bids') || title.includes('auction')) return false;
          
          // Remove broken/parts items
          if (title.includes('for parts') || title.includes('not working') || title.includes('broken')) return false;
          
          // Remove bundles/lots
          if (title.includes('lot of') || title.includes('bundle')) return false;
          
          // Price sanity checks per category
          if (item.partType === 'gpu' && item.price < 50) return false; // Too cheap = sketchy
          if (item.partType === 'cpu' && item.price < 40) return false;
          if (item.partType === 'motherboard' && item.price < 30) return false;
          
          return true;
        });

        // Get AI recommendations
        const featured = await getAIRecommendations(filtered);
        displayDeals(featured);

      } catch (error) {
        console.error('Error loading deals:', error);
        document.getElementById('loading').innerHTML = '<p>Error loading deals. Please try again later.</p>';
      }
    }

    async function getAIRecommendations(items) {
      try {
        // Prepare items for AI analysis
        const itemsForAI = items.slice(0, 100).map(item => ({
          title: item.title,
          price: item.price,
          partType: item.partType,
          condition: item.condition,
          site: item.site
        }));

        const prompt = `You are a PC parts deal expert. Analyze these ${itemsForAI.length} PC parts listings and select the 6 BEST VALUE deals for someone building a gaming PC.

Criteria for selection:
1. Good price-to-performance ratio (not just cheapest)
2. Reliable brands (MSI, ASUS, Corsair, etc.)
3. Mix of different part types (GPU, CPU, motherboard, etc.)
4. Avoid suspiciously cheap items
5. Prefer "New" or "Open Box" over "Used" when prices are similar
6. Skip obvious red flags in titles

Here are the items:
${JSON.stringify(itemsForAI, null, 2)}

Respond with ONLY a JSON array of 6 numbers representing the indices of the best deals. For example: [0, 5, 12, 23, 45, 67]`;

        const response = await fetch("https://api.anthropic.com/v1/messages", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            model: "claude-sonnet-4-20250514",
            max_tokens: 1000,
            messages: [
              { role: "user", content: prompt }
            ],
          })
        });

        if (!response.ok) {
          console.warn('AI API failed, falling back to heuristic selection');
          return heuristicSelection(items);
        }

        const data = await response.json();
        const textContent = data.content.find(c => c.type === "text");
        
        if (!textContent) {
          return heuristicSelection(items);
        }

        // Parse AI response
        const aiText = textContent.text.trim();
        const jsonMatch = aiText.match(/\[[\d,\s]+\]/);
        
        if (!jsonMatch) {
          console.warn('Could not parse AI response, using fallback');
          return heuristicSelection(items);
        }

        const indices = JSON.parse(jsonMatch[0]);
        const selected = indices
          .filter(i => i < items.length)
          .map(i => items[i])
          .filter(Boolean);

        return selected.length >= 4 ? selected : heuristicSelection(items);

      } catch (error) {
        console.error('AI recommendation error:', error);
        return heuristicSelection(items);
      }
    }

    function heuristicSelection(items) {
      // Fallback: Smart heuristic-based selection
      const scored = items.map(item => {
        let score = 0;
        
        // Prefer newer condition
        if (item.condition === 'New') score += 20;
        else if (item.condition === 'Open Box') score += 10;
        
        // Prefer fixed price sites
        if (item.site === 'newegg') score += 15;
        if (item.site === 'bestbuy') score += 10;
        
        // Brand recognition (simple check)
        const title = item.title.toLowerCase();
        const goodBrands = ['msi', 'asus', 'evga', 'corsair', 'samsung', 'crucial', 'western digital', 'seagate'];
        if (goodBrands.some(brand => title.includes(brand))) score += 10;
        
        // Price/value ratio (lower is better but not too low)
        const priceRatios = {
          gpu: item.price / 200,
          cpu: item.price / 150,
          motherboard: item.price / 120,
          psu: item.price / 80,
          case: item.price / 70,
          ssd: item.price / 90
        };
        
        const ratio = priceRatios[item.partType] || 1;
        if (ratio > 0.5 && ratio < 1.5) score += 15; // Sweet spot
        
        return { ...item, score };
      });

      // Sort by score and pick diverse set
      scored.sort((a, b) => b.score - a.score);
      
      const selected = [];
      const usedTypes = new Set();
      
      // First pass: one of each type
      for (const item of scored) {
        if (!usedTypes.has(item.partType) && selected.length < 6) {
          selected.push(item);
          usedTypes.add(item.partType);
        }
      }
      
      // Second pass: fill remaining
      for (const item of scored) {
        if (selected.length >= 6) break;
        if (!selected.includes(item)) {
          selected.push(item);
        }
      }
      
      return selected.slice(0, 6);
    }

    function displayDeals(deals) {
      const container = document.getElementById('deals');
      const loading = document.getElementById('loading');
      
      container.innerHTML = '';
      
      deals.forEach(deal => {
        const card = document.createElement('div');
        card.className = 'deal-card';
        
        const savings = calculateSavings(deal.price);
        const imgSrc = upgradeEbayImg(deal.image_url) || FALLBACK_IMG;
        
        card.innerHTML = `
          <div class="deal-badge">-${savings}%</div>
          <img src="${imgSrc}" alt="${deal.title}" class="deal-image" 
               onerror="this.src='${FALLBACK_IMG}'" loading="lazy">
          <div class="deal-content">
            <h3 class="deal-title">${deal.title || deal.name}</h3>
            <div class="deal-meta">
              <span class="deal-tag">${deal.partType}</span>
              <span class="deal-tag">${deal.site}</span>
              <span class="deal-tag">${deal.condition}</span>
            </div>
            <div class="deal-price">$${deal.price.toFixed(2)}</div>
            <p class="deal-reason">${getAIReason(deal)}</p>
            <a href="${deal.url}" target="_blank" rel="noopener noreferrer" class="deal-button">
              View Deal →
            </a>
          </div>
        `;
        
        container.appendChild(card);
      });
      
      loading.style.display = 'none';
      container.style.display = 'grid';
    }

    // Load deals on page load
    loadFeaturedDeals();
  </script>
</body>
</html>