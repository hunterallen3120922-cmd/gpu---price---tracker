<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PC Parts Tracker - Best Deals on Computer Parts</title>
<style>
:root{color-scheme:dark;--bg-primary:#0a0e17;--bg-secondary:#0f172a;--bg-card:#1e293b;--accent:#3b82f6;--accent-hover:#2563eb;--text-primary:#f1f5f9;--text-secondary:#cbd5e1;--border:rgba(255,255,255,.08)}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg-primary);color:var(--text-primary);line-height:1.6}
nav{background:var(--bg-secondary);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:100;backdrop-filter:blur(12px)}
.nav-container{max-width:1400px;margin:0 auto;padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center}
.logo{font-size:1.5rem;font-weight:800;background:linear-gradient(135deg,#3b82f6 0%,#8b5cf6 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.nav-links{display:flex;gap:2rem;list-style:none}
.nav-links a{color:var(--text-secondary);text-decoration:none;font-weight:500;transition:color .2s}
.nav-links a:hover{color:var(--text-primary)}
.dropdown{position:relative}
.dropdown-toggle{background:none;border:none;color:var(--text-secondary);font-weight:500;font-size:1rem;cursor:pointer;padding:.5rem 1rem;transition:color .2s;display:flex;align-items:center;gap:.5rem}
.dropdown-toggle:hover{color:var(--text-primary)}
.dropdown-toggle::after{content:'‚ñº';font-size:.7rem}
.dropdown-menu{position:absolute;top:100%;left:0;background:var(--bg-card);border:1px solid var(--border);border-radius:12px;margin-top:.5rem;min-width:200px;opacity:0;visibility:hidden;transform:translateY(-10px);transition:all .3s;box-shadow:0 8px 24px rgba(0,0,0,.4)}
.dropdown.active .dropdown-menu{opacity:1;visibility:visible;transform:translateY(0)}
.dropdown-menu a,.dropdown-menu button{display:block;width:100%;padding:.75rem 1rem;color:var(--text-secondary);text-decoration:none;transition:all .2s;border:none;background:none;text-align:left;cursor:pointer;font-size:1rem;font-weight:500}
.dropdown-menu a:hover,.dropdown-menu button:hover{background:var(--bg-secondary);color:var(--text-primary)}
.dropdown-menu a:first-child,.dropdown-menu button:first-child{border-radius:12px 12px 0 0}
.dropdown-menu a:last-child,.dropdown-menu button:last-child{border-radius:0 0 12px 12px}
.hero{max-width:1400px;margin:0 auto;padding:4rem 2rem;text-align:center}
.hero h1{font-size:3.5rem;font-weight:900;margin-bottom:1rem;background:linear-gradient(135deg,#fff 0%,#94a3b8 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero p{font-size:1.25rem;color:var(--text-secondary);margin-bottom:2rem;max-width:600px;margin-left:auto;margin-right:auto}
.cta-button{display:inline-block;padding:1rem 2rem;background:var(--accent);color:white;text-decoration:none;border-radius:12px;font-weight:600;font-size:1.1rem;transition:all .3s;box-shadow:0 4px 20px rgba(59,130,246,.3);border:none;cursor:pointer}
.cta-button:hover{background:var(--accent-hover);transform:translateY(-2px);box-shadow:0 6px 30px rgba(59,130,246,.4)}
.featured-section{max-width:1400px;margin:4rem auto;padding:0 2rem}
.section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}
.section-header h2{font-size:2rem;font-weight:800}
.ai-badge{display:inline-flex;align-items:center;gap:.5rem;padding:.5rem 1rem;background:linear-gradient(135deg,rgba(139,92,246,.2) 0%,rgba(59,130,246,.2) 100%);border:1px solid rgba(139,92,246,.3);border-radius:999px;font-size:.875rem;font-weight:600}
.ai-badge::before{content:"‚ú®";font-size:1rem}
.deals-container{background:var(--bg-card);border:1px solid var(--border);border-radius:24px;padding:2rem;position:relative;overflow:hidden}
.deals-grid{display:flex;gap:1.5rem;transition:opacity 0.5s ease-in-out;flex-wrap:nowrap;overflow:hidden}
.deals-grid.transitioning{opacity:0}
.deal-card{flex:0 0 auto;width:300px;min-width:300px;max-width:300px}
.deal-card{background:var(--bg-card);border:1px solid var(--border);border-radius:16px;overflow:hidden;transition:all .3s;position:relative}
.deal-card:hover{transform:translateY(-4px);box-shadow:0 12px 40px rgba(0,0,0,.4);border-color:rgba(59,130,246,.3)}
.deal-badge{position:absolute;top:12px;right:12px;background:rgba(239,68,68,.9);color:white;padding:.25rem .75rem;border-radius:999px;font-size:.75rem;font-weight:700;z-index:10}
.deal-image{width:100%;aspect-ratio:16/10;background:var(--bg-secondary);object-fit:cover}
.deal-content{padding:1.25rem}
.deal-title{font-size:1rem;font-weight:600;margin-bottom:.5rem;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.deal-meta{display:flex;gap:.75rem;margin-bottom:.75rem;flex-wrap:wrap}
.deal-tag{font-size:.75rem;padding:.25rem .5rem;background:rgba(59,130,246,.15);border:1px solid rgba(59,130,246,.25);border-radius:6px;color:#93c5fd}
.deal-price{font-size:1.75rem;font-weight:900;color:#10b981;margin-bottom:.75rem}
.deal-reason{font-size:.875rem;color:var(--text-secondary);margin-bottom:1rem;font-style:italic;line-height:1.5}
.deal-button{display:block;width:100%;padding:.75rem;background:var(--accent);color:white;text-align:center;text-decoration:none;border-radius:10px;font-weight:600;transition:all .2s}
.deal-button:hover{background:var(--accent-hover)}
.loading{text-align:center;padding:4rem 2rem;color:var(--text-secondary)}
.spinner{width:40px;height:40px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 1rem}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes fadeInUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes slideInLeft{from{opacity:0;transform:translateX(-30px)}to{opacity:1;transform:translateX(0)}}
@keyframes scaleIn{from{opacity:0;transform:scale(0.9)}to{opacity:1;transform:scale(1)}}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
@keyframes shimmer{0%{background-position:200% center}100%{background-position:-200% center}}
nav{animation:fadeIn 0.6s ease-out}
.hero h1{animation:fadeInUp 0.8s ease-out 0.1s;animation-fill-mode:backwards}
.hero p{animation:fadeInUp 0.8s ease-out 0.2s;animation-fill-mode:backwards}
.hero .cta-button{animation:fadeInUp 0.8s ease-out;animation-fill-mode:backwards}
.hero .cta-button:nth-child(1){animation-delay:0.3s}
.hero .cta-button:nth-child(2){animation-delay:0.4s}
.section-header{animation:fadeInUp 0.6s ease-out}
.ai-badge{animation:float 3s ease-in-out infinite}
.deal-card{animation:fadeInUp 0.6s ease-out;animation-fill-mode:backwards}
.deal-card:nth-child(1){animation-delay:0.1s}
.deal-card:nth-child(2){animation-delay:0.15s}
.deal-card:nth-child(3){animation-delay:0.2s}
.deal-card:nth-child(4){animation-delay:0.25s}
.deal-card:nth-child(5){animation-delay:0.3s}
.deal-card:nth-child(6){animation-delay:0.35s}
.modal.active .modal-content{animation:scaleIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)}
.choice-button{animation:slideInLeft 0.5s ease-out;animation-fill-mode:backwards}
.choice-button:nth-child(1){animation-delay:0.1s}
.choice-button:nth-child(2){animation-delay:0.2s}
.build-part{animation:slideInLeft 0.5s ease-out;animation-fill-mode:backwards}
.build-part:nth-child(1){animation-delay:0.1s}
.build-part:nth-child(2){animation-delay:0.15s}
.build-part:nth-child(3){animation-delay:0.2s}
.build-part:nth-child(4){animation-delay:0.25s}
.build-part:nth-child(5){animation-delay:0.3s}
.build-part:nth-child(6){animation-delay:0.35s}
.build-total{animation:scaleIn 0.6s ease-out 0.4s;animation-fill-mode:backwards}
.logo{background:linear-gradient(135deg,#3b82f6 0%,#8b5cf6 50%,#3b82f6 100%);background-size:200% auto;animation:shimmer 3s linear infinite;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);z-index:1000;align-items:center;justify-content:center;padding:2rem}
.modal.active{display:flex}
.modal-content{background:var(--bg-card);border-radius:24px;max-width:800px;width:100%;max-height:90vh;overflow-y:auto;padding:2rem;position:relative;border:1px solid var(--border)}
.modal-close{position:absolute;top:1rem;right:1rem;background:none;border:none;color:var(--text-secondary);font-size:2rem;cursor:pointer;line-height:1;padding:.5rem}
.modal-close:hover{color:var(--text-primary)}
.choice-modal{max-width:600px}
.choice-buttons{display:flex;flex-direction:column;gap:1rem;margin-top:2rem}
.choice-button{padding:2rem;background:var(--bg-secondary);border:2px solid var(--border);border-radius:16px;cursor:pointer;transition:all .3s;text-align:left}
.choice-button:hover{border-color:var(--accent);transform:translateY(-2px);box-shadow:0 8px 24px rgba(59,130,246,.3)}
.choice-button h3{font-size:1.5rem;margin-bottom:.5rem;background:linear-gradient(135deg,#3b82f6 0%,#8b5cf6 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.choice-button p{color:var(--text-secondary);font-size:.9rem;line-height:1.5}
.builder-form{display:flex;flex-direction:column;gap:1.5rem;margin-top:2rem}
.form-group{display:flex;flex-direction:column;gap:.5rem}
.form-group label{font-weight:600;color:var(--text-primary)}
.form-group select,.form-group input{background:var(--bg-secondary);border:1px solid var(--border);border-radius:12px;padding:1rem;color:var(--text-primary);font-size:1rem}
.builder-button{background:linear-gradient(135deg,#8b5cf6 0%,#6366f1 100%);color:white;border:none;padding:1rem 2rem;border-radius:12px;font-weight:600;font-size:1.1rem;cursor:pointer;transition:all .3s;margin-top:1rem}
.builder-button:hover{transform:translateY(-2px);box-shadow:0 6px 30px rgba(139,92,246,.4)}
.builder-button:disabled{opacity:.5;cursor:not-allowed;transform:none}
.build-result{margin-top:2rem;display:none}
.build-result.active{display:block}
.build-part{background:var(--bg-secondary);border:1px solid var(--border);border-radius:12px;padding:1rem;margin-bottom:1rem;display:flex;justify-content:space-between;align-items:center;gap:1rem}
.build-part-info h4{margin:0 0 .25rem 0;color:var(--text-primary)}
.build-part-info p{margin:0;color:var(--text-secondary);font-size:.875rem}
.build-part-price{font-size:1.25rem;font-weight:800;color:#10b981}
.build-total{background:linear-gradient(135deg,rgba(139,92,246,.2) 0%,rgba(59,130,246,.2) 100%);border:2px solid rgba(139,92,246,.3);border-radius:12px;padding:1.5rem;margin-top:1.5rem;text-align:center}
.build-total h3{margin:0 0 .5rem 0;font-size:1.25rem}
.build-total .total-price{font-size:2.5rem;font-weight:900;color:#10b981}

/* Mobile Responsive Styles */
@media (max-width: 768px) {
.hero h1{font-size:2rem}
.hero p{font-size:1rem}
.nav-container{padding:1rem}
.hero{padding:2rem 1rem}
.featured-section{padding:0 1rem}
.deals-container{padding:1rem}
.deals-grid{gap:0}
.deal-card{width:100%;min-width:100%;max-width:100%;margin:0}
.deal-image{aspect-ratio:4/5;object-fit:contain;background:var(--bg-secondary)}
.section-header{flex-direction:column;align-items:flex-start;gap:1rem}
.cta-button{font-size:1rem;padding:.875rem 1.5rem}
}

@media (max-width: 480px) {
.hero h1{font-size:1.75rem}
.logo{font-size:1.25rem}
.deal-title{font-size:.9rem}
.deal-price{font-size:1.5rem}
.deal-image{aspect-ratio:3/4}
}
</style>
</head>
<body>
<nav>
<div class="nav-container">
<div class="logo">PC Parts Tracker</div>
<ul class="nav-links">
<li class="dropdown">
<button class="dropdown-toggle" onclick="toggleDropdown()">Menu</button>
<div class="dropdown-menu">
<button onclick="openChoiceModal(); toggleDropdown()">üõ†Ô∏è PC Builder</button>
<a href="browse.html" onclick="toggleDropdown()">Browse All Parts</a>
</div>
</li>
</ul>
</div>
</nav>

<section class="hero">
<h1>Find the Best PC Part Deals</h1>
<p>AI-powered deal discovery across eBay, Newegg, and more. Save money on your next build.</p>
<div style="display:flex;gap:1rem;justify-content:center;flex-wrap:wrap">
<a href="browse.html" class="cta-button">Browse All Parts</a>
<button class="cta-button" onclick="openChoiceModal()" style="background:linear-gradient(135deg,#8b5cf6 0%,#6366f1 100%)">‚ú® AI PC Builder</button>
</div>
</section>

<!-- Choice Modal -->
<div id="choiceModal" class="modal">
<div class="modal-content choice-modal">
<button class="modal-close" onclick="closeChoiceModal()">√ó</button>
<h2 style="font-size:2rem;margin-bottom:.5rem;text-align:center">Choose Your Builder</h2>
<p style="color:var(--text-secondary);text-align:center;margin-bottom:1rem">How would you like to build your PC?</p>
<div class="choice-buttons">
<div class="choice-button" onclick="window.location.href='builder.html'">
<h3>üõ†Ô∏è Manual Builder</h3>
<p>Hand-pick each component yourself. Browse through our curated selection and choose exactly what you want for each part.</p>
</div>
<div class="choice-button" onclick="openAIBuilder()">
<h3>‚ú® AI Builder</h3>
<p>Let our smart algorithm build your PC. Just tell us your budget and what you'll use it for, and we'll select compatible parts for you.</p>
</div>
</div>
</div>
</div>

<!-- AI Builder Modal -->
<div id="aiBuilderModal" class="modal">
<div class="modal-content">
<button class="modal-close" onclick="closeAIBuilder()">√ó</button>
<h2 style="font-size:2rem;margin-bottom:.5rem">AI PC Builder</h2>
<p style="color:var(--text-secondary);margin-bottom:1rem">Let AI find the perfect components for your budget and needs</p>
<div class="builder-form">
<div class="form-group">
<label>What's your budget?</label>
<input type="number" id="budget" placeholder="e.g., 1000" min="300" max="5000"/>
</div>
<div class="form-group">
<label>What will you use it for?</label>
<select id="useCase">
<option value="">Select use case...</option>
<option value="gaming">Gaming</option>
<option value="productivity">Productivity / Work</option>
<option value="content-creation">Content Creation / Video Editing</option>
<option value="budget">Basic Use / Budget Build</option>
<option value="enthusiast">High-End / Enthusiast</option>
</select>
</div>
<div class="form-group">
<label>Performance priority?</label>
<select id="priority">
<option value="">Select priority...</option>
<option value="balanced">Balanced (best value)</option>
<option value="gpu">GPU focused (gaming/rendering)</option>
<option value="cpu">CPU focused (productivity)</option>
<option value="storage">Storage focused (large files)</option>
</select>
</div>
<div class="form-group">
<label>Condition preference?</label>
<select id="conditionPref">
<option value="any">Any condition (best deals)</option>
<option value="new">New only</option>
<option value="new-openbox">New or Open Box</option>
</select>
</div>
<button class="builder-button" onclick="generateBuild()" id="generateBtn">‚ú® Generate My Build</button>
</div>
<div id="buildResult" class="build-result">
<h3 style="margin:2rem 0 1rem 0">Your Custom Build</h3>
<div id="buildParts"></div>
<div class="build-total">
<h3>Total Build Cost</h3>
<div class="total-price" id="totalPrice">$0.00</div>
<p style="margin:.5rem 0 0 0;color:var(--text-secondary)">Based on current available deals</p>
</div>
</div>
</div>
</div>

<div class="featured-section">
<div class="section-header">
<h2>Featured Deals</h2>
<span class="ai-badge">AI Recommended</span>
</div>
<div class="deals-container">
<div id="loading" class="loading">
<div class="spinner"></div>
<p>Finding the best deals...</p>
</div>
<div id="deals" class="deals-grid" style="display:none"></div>
</div>
</div>

<script>
const FALLBACK_IMG = "data:image/svg+xml;charset=utf-8," + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="750"><rect width="100%" height="100%" fill="#0b1220"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="Arial" font-size="42" fill="#7aa2ff">No Image</text></svg>');

// Dropdown menu functions
function toggleDropdown() {
    const dropdown = document.querySelector('.dropdown');
    dropdown.classList.toggle('active');
}

document.addEventListener('click', function(event) {
    const dropdown = document.querySelector('.dropdown');
    if (dropdown && !dropdown.contains(event.target)) {
        dropdown.classList.remove('active');
    }
});

// Modal functions
function openChoiceModal() {
    document.getElementById('choiceModal').classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeChoiceModal() {
    document.getElementById('choiceModal').classList.remove('active');
    document.body.style.overflow = 'auto';
}

function openAIBuilder() {
    document.getElementById('choiceModal').classList.remove('active');
    document.getElementById('aiBuilderModal').classList.add('active');
}

function closeAIBuilder() {
    document.getElementById('aiBuilderModal').classList.remove('active');
    document.body.style.overflow = 'auto';
}

// Utility functions
function upgradeEbayImg(url) {
    if (!url) return FALLBACK_IMG;
    return String(url).trim().replace(/\/s-l\d+\.(jpg|jpeg|png|webp)$/i, '/s-l1600.$1');
}

function calculateSavings() {
    return Math.round(Math.random() * 30) + 10;
}

function getAIReason() {
    const reasons = [
        'Best price-to-performance ratio in category',
        'Trending deal - price dropped recently',
        'High-value component for budget builds',
        'Popular choice with excellent reviews',
        'Great deal compared to market average'
    ];
    return reasons[Math.floor(Math.random() * reasons.length)];
}

// Load featured deals
async function loadFeaturedDeals() {
    try {
        const categories = ['gpu', 'cpu', 'motherboard', 'psu', 'case', 'ssd'];
        const allParts = [];
        
        for (const category of categories) {
            try {
                const response = await fetch(`data/${category}.json`, { cache: 'no-store' });
                if (response.ok) {
                    const parts = await response.json();
                    allParts.push(...parts);
                }
            } catch (error) {
                console.warn(`Failed to load ${category}:`, error);
            }
        }
        
        if (allParts.length === 0) {
            document.getElementById('loading').innerHTML = '<p>No deals found. Check back soon!</p>';
            return;
        }
        
        const validParts = allParts.filter(part => {
            if (!part.price || part.price <= 0) return false;
            const title = (part.title || '').toLowerCase();
            if (title.includes('bid') || title.includes('auction')) return false;
            if (title.includes('for parts') || title.includes('broken')) return false;
            return true;
        });
        
        const selectedDeals = heuristicSelection(validParts);
        displayDeals(selectedDeals);
    } catch (error) {
        console.error('Error loading deals:', error);
        document.getElementById('loading').innerHTML = '<p>Error loading deals. Please try again later.</p>';
    }
}

function heuristicSelection(parts) {
    const scored = parts.map(part => {
        let score = 0;
        if (part.condition === 'New') score += 20;
        else if (part.condition === 'Open Box') score += 10;
        if (part.site === 'newegg') score += 15;
        const title = part.title.toLowerCase();
        const brands = ['msi', 'asus', 'corsair', 'samsung'];
        if (brands.some(brand => title.includes(brand))) score += 10;
        return { ...part, score };
    });
    
    scored.sort((a, b) => b.score - a.score);
    
    const selected = [];
    const categoriesUsed = new Set();
    
    // First, get at least one of each category
    for (const part of scored) {
        if (!categoriesUsed.has(part.partType) && selected.length < 6) {
            selected.push(part);
            categoriesUsed.add(part.partType);
        }
    }
    
    // Then fill up to 18 with the best scored items
    for (const part of scored) {
        if (selected.length >= 18) break;
        if (!selected.includes(part)) {
            selected.push(part);
        }
    }
    
    return selected.slice(0, 18);
}

function displayDeals(deals) {
    const dealsContainer = document.getElementById('deals');
    const loadingContainer = document.getElementById('loading');
    
    let allDeals = [...deals];
    let currentIndex = 0;
    
    function showDealsSet() {
        // Calculate exactly how many cards fit in one row
        const containerElement = dealsContainer.parentElement;
        const containerWidth = containerElement.offsetWidth - 64; // minus padding (2rem * 2)
        const cardWidth = 300;
        const gap = 24; // 1.5rem
        
        // Check if mobile (screen width < 768px)
        const isMobile = window.innerWidth < 768;
        
        // On mobile, always show exactly 1 card
        let cardsPerRow;
        if (isMobile) {
            cardsPerRow = 1;
        } else {
            // Calculate cards that fit - being conservative to never overflow
            cardsPerRow = Math.floor((containerWidth + gap) / (cardWidth + gap));
        }
        
        // Safety check - ensure at least 1 card, max based on available deals
        cardsPerRow = Math.max(1, Math.min(cardsPerRow, allDeals.length));
        
        // Get current set of deals
        const currentDeals = [];
        for (let i = 0; i < cardsPerRow; i++) {
            currentDeals.push(allDeals[(currentIndex + i) % allDeals.length]);
        }
        
        // Fade out
        dealsContainer.classList.add('transitioning');
        
        setTimeout(() => {
            dealsContainer.innerHTML = '';
            
            currentDeals.forEach(deal => {
                const card = document.createElement('div');
                card.className = 'deal-card';
                
                const savings = calculateSavings();
                const imgUrl = upgradeEbayImg(deal.image_url);
                
                card.innerHTML = `
                    <div class="deal-badge">-${savings}%</div>
                    <img src="${imgUrl}" alt="${deal.title}" class="deal-image" onerror="this.src='${FALLBACK_IMG}'" loading="lazy">
                    <div class="deal-content">
                        <h3 class="deal-title">${deal.title || deal.name}</h3>
                        <div class="deal-meta">
                            <span class="deal-tag">${deal.partType}</span>
                            <span class="deal-tag">${deal.site}</span>
                            <span class="deal-tag">${deal.condition}</span>
                        </div>
                        <div class="deal-price">$${deal.price.toFixed(2)}</div>
                        <p class="deal-reason">${getAIReason()}</p>
                        <a href="${deal.url}" target="_blank" rel="noopener noreferrer" class="deal-button">View Deal ‚Üí</a>
                    </div>
                `;
                
                dealsContainer.appendChild(card);
            });
            
            // Fade in
            dealsContainer.classList.remove('transitioning');
            
            // Move to next set
            currentIndex = (currentIndex + cardsPerRow) % allDeals.length;
        }, 500);
    }
    
    // Initial display
    showDealsSet();
    loadingContainer.style.display = 'none';
    dealsContainer.style.display = 'flex';
    
    // Auto-rotate every 5 seconds
    setInterval(showDealsSet, 5000);
    
    // Recalculate on window resize
    let resizeTimeout;
    window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
            dealsContainer.classList.add('transitioning');
            setTimeout(showDealsSet, 500);
        }, 250);
    });
}

// AI PC Builder
async function generateBuild() {
    const budget = parseFloat(document.getElementById('budget').value);
    const useCase = document.getElementById('useCase').value;
    const priority = document.getElementById('priority').value;
    const conditionPref = document.getElementById('conditionPref').value;
    
    if (!budget || !useCase || !priority) {
        alert('Please fill in all required fields');
        return;
    }
    
    const generateBtn = document.getElementById('generateBtn');
    generateBtn.disabled = true;
    generateBtn.textContent = 'ü§ñ Building your PC...';
    
    try {
        const categories = ['gpu', 'cpu', 'motherboard', 'psu', 'case', 'ssd'];
        const allParts = {};
        
        for (const category of categories) {
            const response = await fetch(`data/${category}.json`, { cache: 'no-store' });
            if (response.ok) {
                allParts[category] = await response.json();
            }
        }
        
        const build = smartBuildPC(budget, useCase, priority, allParts, conditionPref);
        
        if (build) {
            displayBuild(build);
        } else {
            alert('Could not find compatible parts within budget. Try increasing your budget or changing preferences.');
        }
        
    } catch (error) {
        console.error('Build error:', error);
        alert('Error building PC. Please try again.');
    } finally {
        generateBtn.disabled = false;
        generateBtn.textContent = '‚ú® Generate My Build';
    }
}

function smartBuildPC(budget, useCase, priority, allParts, conditionPref) {
    const budgetAllocation = {
        gaming: { gpu: 0.35, cpu: 0.20, motherboard: 0.15, psu: 0.10, case: 0.08, ssd: 0.12 },
        productivity: { gpu: 0.15, cpu: 0.30, motherboard: 0.18, psu: 0.12, case: 0.10, ssd: 0.15 },
        'content-creation': { gpu: 0.30, cpu: 0.25, motherboard: 0.15, psu: 0.12, case: 0.08, ssd: 0.10 },
        budget: { gpu: 0.25, cpu: 0.20, motherboard: 0.15, psu: 0.12, case: 0.10, ssd: 0.18 },
        enthusiast: { gpu: 0.40, cpu: 0.25, motherboard: 0.12, psu: 0.10, case: 0.06, ssd: 0.07 }
    };
    
    let allocation = { ...budgetAllocation[useCase] };
    
    if (priority === 'gpu') {
        allocation.gpu += 0.10;
        allocation.cpu -= 0.05;
        allocation.motherboard -= 0.05;
    } else if (priority === 'cpu') {
        allocation.cpu += 0.10;
        allocation.gpu -= 0.05;
        allocation.ssd -= 0.05;
    }
    
    const targetPrices = Object.fromEntries(
        Object.keys(allocation).map(part => [part, budget * allocation[part]])
    );
    
    const findBestPart = (parts, targetPrice, flexibility) => {
        if (!parts?.length) return null;
        
        let validParts = parts.filter(p => p.price > 0);
        
        if (conditionPref === 'new') {
            validParts = validParts.filter(p => p.condition === 'New');
        } else if (conditionPref === 'new-openbox') {
            validParts = validParts.filter(p => p.condition === 'New' || p.condition === 'Open Box');
        }
        
        const sorted = validParts.sort((a, b) => a.price - b.price);
        const inRange = sorted.filter(p => 
            p.price >= targetPrice * (1 - flexibility) && 
            p.price <= targetPrice * (1 + flexibility)
        );
        
        if (inRange.length > 0) {
            return inRange[Math.floor(inRange.length / 2)];
        }
        
        return sorted[0];
    };
    
    const gpu = findBestPart(allParts.gpu, targetPrices.gpu, 0.3);
    const cpu = findBestPart(allParts.cpu, targetPrices.cpu, 0.3);
    
    if (!gpu || !cpu) return null;
    
    const cpuName = cpu.title.toLowerCase();
    const compatibleMotherboards = (allParts.motherboard?.filter(mb => {
        const title = mb.title.toLowerCase();
        if (cpuName.includes('ryzen') || cpuName.includes('amd')) {
            return title.includes('am4') || title.includes('am5') || title.includes('amd');
        } else {
            return title.includes('lga') || title.includes('intel');
        }
    }) || []);
    
    const motherboard = findBestPart(compatibleMotherboards, targetPrices.motherboard, 0.4);
    const psu = findBestPart(allParts.psu, targetPrices.psu, 0.3);
    const pcCase = findBestPart(allParts.case, targetPrices.case, 0.4);
    const ssd = findBestPart(allParts.ssd, targetPrices.ssd, 0.3);
    
    if (!motherboard || !psu || !pcCase || !ssd) return null;
    
    return { gpu, cpu, motherboard, psu, case: pcCase, ssd };
}

function displayBuild(build) {
    const partsContainer = document.getElementById('buildParts');
    const resultContainer = document.getElementById('buildResult');
    
    partsContainer.innerHTML = '';
    let totalCost = 0;
    
    const partNames = {
        gpu: 'Graphics Card',
        cpu: 'Processor',
        motherboard: 'Motherboard',
        psu: 'Power Supply',
        case: 'Case',
        ssd: 'Storage'
    };
    
    for (const [partType, part] of Object.entries(build)) {
        if (!part) continue;
        
        totalCost += part.price;
        
        const partDiv = document.createElement('div');
        partDiv.className = 'build-part';
        partDiv.innerHTML = `
            <div class="build-part-info">
                <h4>${partNames[partType]}</h4>
                <p>${part.title}</p>
                <p style="margin-top:.25rem"><strong>${part.condition}</strong> ‚Ä¢ ${part.site}</p>
            </div>
            <div>
                <div class="build-part-price">$${part.price.toFixed(2)}</div>
                <a href="${part.url}" target="_blank" rel="noopener" style="font-size:.75rem;color:var(--accent);text-decoration:none">View Deal ‚Üí</a>
            </div>
        `;
        
        partsContainer.appendChild(partDiv);
    }
    
    document.getElementById('totalPrice').textContent = `$${totalCost.toFixed(2)}`;
    resultContainer.classList.add('active');
    resultContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

// Initialize
loadFeaturedDeals();
</script>
</body>
</html>
