<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PC Parts Tracker - Best Deals on Computer Parts</title>
  <style>
    :root { 
      color-scheme: dark;
      --bg-primary: #0a0e17;
      --bg-secondary: #0f172a;
      --bg-card: #1e293b;
      --accent: #3b82f6;
      --accent-hover: #2563eb;
      --text-primary: #f1f5f9;
      --text-secondary: #cbd5e1;
      --border: rgba(255,255,255,.08);
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
    }
    
    /* Navigation */
    nav { 
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(12px);
    }
    
    .nav-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      font-size: 1.5rem;
      font-weight: 800;
      background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .nav-links {
      display: flex;
      gap: 2rem;
      list-style: none;
    }
    
    .nav-links a {
      color: var(--text-secondary);
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s;
    }
    
    .nav-links a:hover {
      color: var(--text-primary);
    }
    
    /* Hero Section */
    .hero {
      max-width: 1400px;
      margin: 0 auto;
      padding: 4rem 2rem;
      text-align: center;
    }
    
    .hero h1 {
      font-size: 3.5rem;
      font-weight: 900;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, #fff 0%, #94a3b8 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .hero p {
      font-size: 1.25rem;
      color: var(--text-secondary);
      margin-bottom: 2rem;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .cta-button {
      display: inline-block;
      padding: 1rem 2rem;
      background: var(--accent);
      color: white;
      text-decoration: none;
      border-radius: 12px;
      font-weight: 600;
      font-size: 1.1rem;
      transition: all 0.3s;
      box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
    }
    
    .cta-button:hover {
      background: var(--accent-hover);
      transform: translateY(-2px);
      box-shadow: 0 6px 30px rgba(59, 130, 246, 0.4);
    }
    
    /* Featured Deals Section */
    .featured-section {
      max-width: 1400px;
      margin: 4rem auto;
      padding: 0 2rem;
    }
    
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }
    
    .section-header h2 {
      font-size: 2rem;
      font-weight: 800;
    }
    
    .ai-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 999px;
      font-size: 0.875rem;
      font-weight: 600;
    }
    
    .ai-badge::before {
      content: "âœ¨";
      font-size: 1rem;
    }
    
    .deals-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
    }
    
    .deal-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      transition: all 0.3s;
      position: relative;
    }
    
    .deal-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
      border-color: rgba(59, 130, 246, 0.3);
    }
    
    .deal-badge {
      position: absolute;
      top: 12px;
      right: 12px;
      background: rgba(239, 68, 68, 0.9);
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 700;
      z-index: 10;
    }
    
    .deal-image {
      width: 100%;
      aspect-ratio: 16 / 10;
      background: var(--bg-secondary);
      object-fit: cover;
    }
    
    .deal-content {
      padding: 1.25rem;
    }
    
    .deal-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .deal-meta {
      display: flex;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
      flex-wrap: wrap;
    }
    
    .deal-tag {
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
      background: rgba(59, 130, 246, 0.15);
      border: 1px solid rgba(59, 130, 246, 0.25);
      border-radius: 6px;
      color: #93c5fd;
    }
    
    .deal-price {
      font-size: 1.75rem;
      font-weight: 900;
      color: #10b981;
      margin-bottom: 0.75rem;
    }
    
    .deal-reason {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-bottom: 1rem;
      font-style: italic;
      line-height: 1.5;
    }
    
    .deal-button {
      display: block;
      width: 100%;
      padding: 0.75rem;
      background: var(--accent);
      color: white;
      text-align: center;
      text-decoration: none;
      border-radius: 10px;
      font-weight: 600;
      transition: all 0.2s;
    }
    
    .deal-button:hover {
      background: var(--accent-hover);
    }
    
    /* Loading State */
    .loading {
      text-align: center;
      padding: 4rem 2rem;
      color: var(--text-secondary);
    }
    
    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .hero h1 { font-size: 2.5rem; }
      .nav-links { gap: 1rem; }
      .section-header { flex-direction: column; align-items: flex-start; gap: 1rem; }
    }

    /* PC Builder Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }
    
    .modal.active {
      display: flex;
    }
    
    .modal-content {
      background: var(--bg-card);
      border-radius: 24px;
      max-width: 800px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      padding: 2rem;
      position: relative;
      border: 1px solid var(--border);
    }
    
    .modal-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 2rem;
      cursor: pointer;
      line-height: 1;
      padding: 0.5rem;
    }
    
    .modal-close:hover {
      color: var(--text-primary);
    }
    
    .builder-form {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      margin-top: 2rem;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .form-group label {
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .form-group select,
    .form-group input {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem;
      color: var(--text-primary);
      font-size: 1rem;
    }
    
    .builder-button {
      background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 12px;
      font-weight: 600;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 1rem;
    }
    
    .builder-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 30px rgba(139, 92, 246, 0.4);
    }
    
    .builder-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    .build-result {
      margin-top: 2rem;
      display: none;
    }
    
    .build-result.active {
      display: block;
    }
    
    .build-part {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
    }
    
    .build-part-info h4 {
      margin: 0 0 0.25rem 0;
      color: var(--text-primary);
    }
    
    .build-part-info p {
      margin: 0;
      color: var(--text-secondary);
      font-size: 0.875rem;
    }
    
    .build-part-price {
      font-size: 1.25rem;
      font-weight: 800;
      color: #10b981;
    }
    
    .build-total {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
      border: 2px solid rgba(139, 92, 246, 0.3);
      border-radius: 12px;
      padding: 1.5rem;
      margin-top: 1.5rem;
      text-align: center;
    }
    
    .build-total h3 {
      margin: 0 0 0.5rem 0;
      font-size: 1.25rem;
    }
    
    .build-total .total-price {
      font-size: 2.5rem;
      font-weight: 900;
      color: #10b981;
    }
  </style>
</head>
<body>
  <nav>
    <div class="nav-container">
      <div class="logo">PC Parts Tracker</div>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="browse.html">Browse All</a></li>
      </ul>
    </div>
  </nav>

  <div class="hero">
    <h1>Find the Best PC Part Deals</h1>
    <p>AI-powered deal discovery across eBay, Newegg, and more. Save money on your next build.</p>
    <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
      <a href="browse.html" class="cta-button">Browse All Parts</a>
      <button onclick="openPCBuilder()" class="cta-button" style="background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%); border: none; cursor: pointer;">
        âœ¨ AI PC Builder
      </button>
    </div>
  </div>

  <!-- PC Builder Modal -->
  <div id="pcBuilderModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closePCBuilder()">Ã—</button>
      <h2 style="margin: 0 0 0.5rem 0; font-size: 2rem;">AI PC Builder</h2>
      <p style="color: var(--text-secondary); margin: 0;">Answer a few questions and let AI build your perfect PC from available deals</p>
      
      <div class="builder-form">
        <div class="form-group">
          <label>What's your budget?</label>
          <input type="number" id="budget" placeholder="e.g., 1000" min="300" max="5000" />
        </div>
        
        <div class="form-group">
          <label>What will you use it for?</label>
          <select id="useCase">
            <option value="">Select use case...</option>
            <option value="gaming">Gaming</option>
            <option value="productivity">Productivity / Work</option>
            <option value="content-creation">Content Creation / Video Editing</option>
            <option value="budget">Basic Use / Budget Build</option>
            <option value="enthusiast">High-End / Enthusiast</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>Performance priority?</label>
          <select id="priority">
            <option value="">Select priority...</option>
            <option value="balanced">Balanced (best value)</option>
            <option value="gpu">GPU focused (gaming/rendering)</option>
            <option value="cpu">CPU focused (productivity)</option>
            <option value="storage">Storage focused (large files)</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>Condition preference?</label>
          <select id="conditionPref">
            <option value="any">Any condition (best deals)</option>
            <option value="new">New only</option>
            <option value="new-openbox">New or Open Box</option>
          </select>
        </div>
        
        <button class="builder-button" onclick="generateBuild()" id="generateBtn">
          âœ¨ Generate My Build
        </button>
      </div>
      
      <div id="buildResult" class="build-result">
        <h3 style="margin: 2rem 0 1rem 0;">Your Custom Build</h3>
        <div id="buildParts"></div>
        <div class="build-total">
          <h3>Total Build Cost</h3>
          <div class="total-price" id="totalPrice">$0.00</div>
          <p style="margin: 0.5rem 0 0 0; color: var(--text-secondary);">Based on current available deals</p>
        </div>
      </div>
    </div>
  </div>

  <div class="featured-section">
    <div class="section-header">
      <h2>Featured Deals</h2>
      <span class="ai-badge">AI Recommended</span>
    </div>
    
    <div id="loading" class="loading">
      <div class="spinner"></div>
      <p>Finding the best deals...</p>
    </div>
    
    <div id="deals" class="deals-grid" style="display: none;"></div>
  </div>

  <script>
    const FALLBACK_IMG = "data:image/svg+xml;charset=utf-8," + encodeURIComponent(`
      <svg xmlns="http://www.w3.org/2000/svg" width="1200" height="750">
        <rect width="100%" height="100%" fill="#0f172a"/>
        <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle"
              font-family="Arial" font-size="42" fill="#475569">No Image</text>
      </svg>
    `);

    function upgradeEbayImg(url) {
      if (!url) return "";
      return String(url).replace(/\/s-l\d+\.(jpg|jpeg|png|webp)$/i, "/s-l1600.$1");
    }

    function calculateSavings(price) {
      // Simple heuristic: lower prices = better deal
      const avgPrices = {
        gpu: 300,
        cpu: 250,
        motherboard: 150,
        psu: 100,
        case: 80,
        ssd: 100
      };
      
      return Math.round(Math.random() * 30) + 10; // Placeholder for now
    }

    function getAIReason(item) {
      const reasons = [
        "Best price-to-performance ratio in category",
        "Trending deal - price dropped 15% recently",
        "High-value component for budget builds",
        "Popular choice with excellent reviews",
        "Great deal compared to market average"
      ];
      return reasons[Math.floor(Math.random() * reasons.length)];
    }

    async function loadFeaturedDeals() {
      try {
        // Load all part types
        const partTypes = ['gpu', 'cpu', 'motherboard', 'psu', 'case', 'ssd'];
        const allItems = [];

        for (const part of partTypes) {
          try {
            const res = await fetch(`data/${part}.json`, { cache: 'no-store' });
            if (res.ok) {
              const data = await res.json();
              allItems.push(...data);
            }
          } catch (e) {
            console.warn(`Failed to load ${part}:`, e);
          }
        }

        if (allItems.length === 0) {
          document.getElementById('loading').innerHTML = '<p>No deals found. Check back soon!</p>';
          return;
        }

        // Filter out obvious junk
        const filtered = allItems.filter(item => {
          if (!item.price || item.price <= 0) return false;
          
          const title = (item.title || '').toLowerCase();
          
          // Remove auctions (usually have "bid" or time remaining language)
          if (title.includes('bid') || title.includes('0 bids') || title.includes('auction')) return false;
          
          // Remove broken/parts items
          if (title.includes('for parts') || title.includes('not working') || title.includes('broken')) return false;
          
          // Remove bundles/lots
          if (title.includes('lot of') || title.includes('bundle')) return false;
          
          // Price sanity checks per category
          if (item.partType === 'gpu' && item.price < 50) return false; // Too cheap = sketchy
          if (item.partType === 'cpu' && item.price < 40) return false;
          if (item.partType === 'motherboard' && item.price < 30) return false;
          
          return true;
        });

        // Get AI recommendations
        const featured = await getAIRecommendations(filtered);
        displayDeals(featured);

      } catch (error) {
        console.error('Error loading deals:', error);
        document.getElementById('loading').innerHTML = '<p>Error loading deals. Please try again later.</p>';
      }
    }

    async function getAIRecommendations(items) {
      try {
        // Prepare items for AI analysis
        const itemsForAI = items.slice(0, 100).map(item => ({
          title: item.title,
          price: item.price,
          partType: item.partType,
          condition: item.condition,
          site: item.site
        }));

        const prompt = `You are a PC parts deal expert. Analyze these ${itemsForAI.length} PC parts listings and select the 6 BEST VALUE deals for someone building a gaming PC.

Criteria for selection:
1. Good price-to-performance ratio (not just cheapest)
2. Reliable brands (MSI, ASUS, Corsair, etc.)
3. Mix of different part types (GPU, CPU, motherboard, etc.)
4. Avoid suspiciously cheap items
5. Prefer "New" or "Open Box" over "Used" when prices are similar
6. Skip obvious red flags in titles

Here are the items:
${JSON.stringify(itemsForAI, null, 2)}

Respond with ONLY a JSON array of 6 numbers representing the indices of the best deals. For example: [0, 5, 12, 23, 45, 67]`;

        const response = await fetch("https://api.anthropic.com/v1/messages", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            model: "claude-sonnet-4-20250514",
            max_tokens: 1000,
            messages: [
              { role: "user", content: prompt }
            ],
          })
        });

        if (!response.ok) {
          console.warn('AI API failed, falling back to heuristic selection');
          return heuristicSelection(items);
        }

        const data = await response.json();
        const textContent = data.content.find(c => c.type === "text");
        
        if (!textContent) {
          return heuristicSelection(items);
        }

        // Parse AI response
        const aiText = textContent.text.trim();
        const jsonMatch = aiText.match(/\[[\d,\s]+\]/);
        
        if (!jsonMatch) {
          console.warn('Could not parse AI response, using fallback');
          return heuristicSelection(items);
        }

        const indices = JSON.parse(jsonMatch[0]);
        const selected = indices
          .filter(i => i < items.length)
          .map(i => items[i])
          .filter(Boolean);

        return selected.length >= 4 ? selected : heuristicSelection(items);

      } catch (error) {
        console.error('AI recommendation error:', error);
        return heuristicSelection(items);
      }
    }

    function heuristicSelection(items) {
      // Fallback: Smart heuristic-based selection
      const scored = items.map(item => {
        let score = 0;
        
        // Prefer newer condition
        if (item.condition === 'New') score += 20;
        else if (item.condition === 'Open Box') score += 10;
        
        // Prefer fixed price sites
        if (item.site === 'newegg') score += 15;
        if (item.site === 'bestbuy') score += 10;
        
        // Brand recognition (simple check)
        const title = item.title.toLowerCase();
        const goodBrands = ['msi', 'asus', 'evga', 'corsair', 'samsung', 'crucial', 'western digital', 'seagate'];
        if (goodBrands.some(brand => title.includes(brand))) score += 10;
        
        // Price/value ratio (lower is better but not too low)
        const priceRatios = {
          gpu: item.price / 200,
          cpu: item.price / 150,
          motherboard: item.price / 120,
          psu: item.price / 80,
          case: item.price / 70,
          ssd: item.price / 90
        };
        
        const ratio = priceRatios[item.partType] || 1;
        if (ratio > 0.5 && ratio < 1.5) score += 15; // Sweet spot
        
        return { ...item, score };
      });

      // Sort by score and pick diverse set
      scored.sort((a, b) => b.score - a.score);
      
      const selected = [];
      const usedTypes = new Set();
      
      // First pass: one of each type
      for (const item of scored) {
        if (!usedTypes.has(item.partType) && selected.length < 6) {
          selected.push(item);
          usedTypes.add(item.partType);
        }
      }
      
      // Second pass: fill remaining
      for (const item of scored) {
        if (selected.length >= 6) break;
        if (!selected.includes(item)) {
          selected.push(item);
        }
      }
      
      return selected.slice(0, 6);
    }

    function displayDeals(deals) {
      const container = document.getElementById('deals');
      const loading = document.getElementById('loading');
      
      container.innerHTML = '';
      
      deals.forEach(deal => {
        const card = document.createElement('div');
        card.className = 'deal-card';
        
        const savings = calculateSavings(deal.price);
        const imgSrc = upgradeEbayImg(deal.image_url) || FALLBACK_IMG;
        
        card.innerHTML = `
          <div class="deal-badge">-${savings}%</div>
          <img src="${imgSrc}" alt="${deal.title}" class="deal-image" 
               onerror="this.src='${FALLBACK_IMG}'" loading="lazy">
          <div class="deal-content">
            <h3 class="deal-title">${deal.title || deal.name}</h3>
            <div class="deal-meta">
              <span class="deal-tag">${deal.partType}</span>
              <span class="deal-tag">${deal.site}</span>
              <span class="deal-tag">${deal.condition}</span>
            </div>
            <div class="deal-price">$${deal.price.toFixed(2)}</div>
            <p class="deal-reason">${getAIReason(deal)}</p>
            <a href="${deal.url}" target="_blank" rel="noopener noreferrer" class="deal-button">
              View Deal â†’
            </a>
          </div>
        `;
        
        container.appendChild(card);
      });
      
      loading.style.display = 'none';
      container.style.display = 'grid';
    }

    // Load deals on page load
    loadFeaturedDeals();

    // PC Builder Functions
    function openPCBuilder() {
      document.getElementById('pcBuilderModal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closePCBuilder() {
      document.getElementById('pcBuilderModal').classList.remove('active');
      document.body.style.overflow = 'auto';
    }

    async function generateBuild() {
      const budget = document.getElementById('budget').value;
      const useCase = document.getElementById('useCase').value;
      const priority = document.getElementById('priority').value;
      const conditionPref = document.getElementById('conditionPref').value;

      if (!budget || !useCase || !priority) {
        alert('Please fill in all required fields');
        return;
      }

      const btn = document.getElementById('generateBtn');
      btn.disabled = true;
      btn.textContent = 'ðŸ¤– AI is building your PC...';

      try {
        // Load all available parts
        const partTypes = ['gpu', 'cpu', 'motherboard', 'psu', 'case', 'ssd'];
        const allParts = {};

        for (const part of partTypes) {
          try {
            const res = await fetch(`data/${part}.json`, { cache: 'no-store' });
            if (res.ok) {
              const data = await res.json();
              // Filter by condition preference
              let filtered = data.filter(item => item.price && item.price > 0);
              
              if (conditionPref === 'new') {
                filtered = filtered.filter(item => item.condition === 'New');
              } else if (conditionPref === 'new-openbox') {
                filtered = filtered.filter(item => item.condition === 'New' || item.condition === 'Open Box');
              }
              
              allParts[part] = filtered.sort((a, b) => a.price - b.price).slice(0, 20);
            }
          } catch (e) {
            console.warn(`Failed to load ${part}:`, e);
            allParts[part] = [];
          }
        }

        // Prepare data for AI
        const prompt = `You are a PC building expert. Build a complete gaming PC within a ${budget} budget.

Use case: ${useCase}
Priority: ${priority}
Condition preference: ${conditionPref}

Available parts (top 20 cheapest in each category):
${JSON.stringify({
  gpus: allParts.gpu.map(p => ({ title: p.title, price: p.price, condition: p.condition })),
  cpus: allParts.cpu.map(p => ({ title: p.title, price: p.price, condition: p.condition })),
  motherboards: allParts.motherboard.map(p => ({ title: p.title, price: p.price, condition: p.condition })),
  psus: allParts.psu.map(p => ({ title: p.title, price: p.price, condition: p.condition })),
  cases: allParts.case.map(p => ({ title: p.title, price: p.price, condition: p.condition })),
  ssds: allParts.ssd.map(p => ({ title: p.title, price: p.price, condition: p.condition }))
}, null, 2)}

Build a complete PC with: GPU, CPU, Motherboard, PSU, Case, and SSD.

CRITICAL RULES:
1. Total cost must be under ${budget}
2. Ensure compatibility (AMD CPU needs AMD motherboard, Intel needs Intel)
3. PSU must be sufficient for the GPU/CPU
4. Prioritize ${priority}
5. Pick parts that match the ${useCase} use case

Respond with ONLY a JSON object in this exact format:
{
  "gpu": 0,
  "cpu": 5,
  "motherboard": 2,
  "psu": 1,
  "case": 0,
  "ssd": 3,
  "reasoning": "Brief explanation of choices"
}

The numbers are the array indices of the parts you selected. DO NOT include any other text.`;

        const response = await fetch("https://api.anthropic.com/v1/messages", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            model: "claude-sonnet-4-20250514",
            max_tokens: 2000,
            messages: [
              { role: "user", content: prompt }
            ],
          })
        });

        if (!response.ok) {
          throw new Error('AI service unavailable');
        }

        const data = await response.json();
        const textContent = data.content.find(c => c.type === "text");
        
        if (!textContent) {
          throw new Error('No response from AI');
        }

        // Parse AI response
        const aiText = textContent.text.trim();
        const jsonMatch = aiText.match(/\{[\s\S]*\}/);
        
        if (!jsonMatch) {
          throw new Error('Invalid AI response format');
        }

        const buildPlan = JSON.parse(jsonMatch[0]);

        // Display the build
        displayBuild(buildPlan, allParts);

      } catch (error) {
        console.error('Build generation error:', error);
        alert('Failed to generate build. Please try again.');
      } finally {
        btn.disabled = false;
        btn.textContent = 'âœ¨ Generate My Build';
      }
    }

    function displayBuild(buildPlan, allParts) {
      const buildPartsDiv = document.getElementById('buildParts');
      const buildResultDiv = document.getElementById('buildResult');
      
      buildPartsDiv.innerHTML = '';
      let total = 0;

      const partLabels = {
        gpu: 'Graphics Card',
        cpu: 'Processor',
        motherboard: 'Motherboard',
        psu: 'Power Supply',
        case: 'Case',
        ssd: 'Storage'
      };

      for (const [partType, index] of Object.entries(buildPlan)) {
        if (partType === 'reasoning') continue;
        
        const part = allParts[partType][index];
        if (!part) continue;

        total += part.price;

        const partDiv = document.createElement('div');
        partDiv.className = 'build-part';
        partDiv.innerHTML = `
          <div class="build-part-info">
            <h4>${partLabels[partType]}</h4>
            <p>${part.title}</p>
            <p style="margin-top: 0.25rem;"><strong>${part.condition}</strong> â€¢ ${part.site}</p>
          </div>
          <div>
            <div class="build-part-price">${part.price.toFixed(2)}</div>
            <a href="${part.url}" target="_blank" rel="noopener" 
               style="font-size: 0.75rem; color: var(--accent); text-decoration: none;">
              View Deal â†’
            </a>
          </div>
        `;
        buildPartsDiv.appendChild(partDiv);
      }

      document.getElementById('totalPrice').textContent = `${total.toFixed(2)}`;
      
      buildResultDiv.classList.add('active');
      buildResultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }
  </script>
</body>
</html>